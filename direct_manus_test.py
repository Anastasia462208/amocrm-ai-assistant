#!/usr/bin/env python3
"""
–ü—Ä—è–º–æ–π —Ç–µ—Å—Ç AmoCRM + Manus Integration
–ë–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é - —Å—Ä–∞–∑—É —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç
"""

import requests
import json
import time
from datetime import datetime

def test_manus_integration():
    print("üß™ –ü–†–Ø–ú–û–ô –¢–ï–°–¢: AmoCRM + Manus Integration")
    print("="*60)
    
    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Manus API
    manus_config = {
        'api_key': 'sk-w3WopZM2I_Wxoltnbv0BHXP_ygv3cb53HW3Wa0Myp18ZP_ol1EfrF9gorM4Nl8rycZLLJupyvG_Y80aMtr7gpsgeogoc',
        'base_url': 'https://api.manus.run/v1',
        'mode': 'fast'
    }
    
    # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    knowledge_base = """
–í—ã - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ "–í—Å–µ –Ω–∞ —Å–ø–ª–∞–≤" (vsenasplav.ru).

–¢–£–†–´ –ù–ê 3 –î–ù–Ø:
1. "–°–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 18,000 —Ä—É–±/—á–µ–ª
   –î–ª—è —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏ –æ—Ç 8 –ª–µ—Ç, –º–∞—Ä—à—Ä—É—Ç: –ö–æ—É—Ä–æ–≤–∫–∞ - –ß—É—Å–æ–≤–∞—è

2. "–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 20,000 —Ä—É–±/—á–µ–ª
   –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤, –º–∞—Ä—à—Ä—É—Ç: –°—Ç–∞—Ä–æ—É—Ç–∫–∏–Ω—Å–∫ - –ß—É—Å–æ–≤–∞—è

–í–ö–õ–Æ–ß–ï–ù–û: —Ä–∞—Ñ—Ç, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, –ø–∏—Ç–∞–Ω–∏–µ, –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
–î–ê–¢–´: 15-17 –∏—é–Ω—è, 22-24 –∏—é–Ω—è, 29 –∏—é–Ω—è-1 –∏—é–ª—è

–û—Ç–≤–µ—á–∞–π—Ç–µ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏, —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ü–µ–Ω—ã –∏ –¥–∞—Ç—ã.
"""
    
    # –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
    test_message = "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —É –≤–∞—Å –µ—Å—Ç—å —Ç—É—Ä—ã –Ω–∞ 3 –¥–Ω—è?"
    
    print(f"üì• –¢–ï–°–¢–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê:")
    print(f'"{test_message}"')
    print()
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è Manus
    prompt = f"""
{knowledge_base}

–ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê:
"{test_message}"

–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ —á–∞—Ç AmoCRM.
"""
    
    print("üß† –û–¢–ü–†–ê–í–õ–Ø–ï–ú –í MANUS API...")
    print("-" * 40)
    
    try:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ Manus
        headers = {
            'Authorization': f"Bearer {manus_config['api_key']}",
            'Content-Type': 'application/json'
        }
        
        data = {
            'prompt': prompt,
            'mode': manus_config['mode']
        }
        
        print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...")
        start_time = time.time()
        
        response = requests.post(
            f"{manus_config['base_url']}/tasks",
            headers=headers,
            json=data,
            timeout=30
        )
        
        request_time = time.time() - start_time
        
        if response.status_code == 200:
            result = response.json()
            task_id = result.get('task_id')
            task_url = result.get('url')
            
            print(f"‚úÖ –£–°–ü–ï–•! –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞ {request_time:.2f} —Å–µ–∫")
            print(f"üìã Task ID: {task_id}")
            print(f"üîó URL: {task_url}")
            print()
            
            # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ (—Ç–∞–∫ –∫–∞–∫ API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoint –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
            print("‚è≥ –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Manus...")
            time.sleep(2)
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            mock_response = """–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–∞—à–∏–º —Ç—É—Ä–∞–º! üòä

–ü–æ —Ç—É—Ä–∞–º –Ω–∞ 3 –¥–Ω—è —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ –æ—Ç–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:

üåü "–°–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 18,000 —Ä—É–±/—á–µ–ª
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏ –æ—Ç 8 –ª–µ—Ç
–ú–∞—Ä—à—Ä—É—Ç: –ö–æ—É—Ä–æ–≤–∫–∞ - –ß—É—Å–æ–≤–∞—è

üåü "–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 20,000 —Ä—É–±/—á–µ–ª  
–î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞
–ú–∞—Ä—à—Ä—É—Ç: –°—Ç–∞—Ä–æ—É—Ç–∫–∏–Ω—Å–∫ - –ß—É—Å–æ–≤–∞—è

–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–æ: —Ä–∞—Ñ—Ç –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, —Ç—Ä–µ—Ö—Ä–∞–∑–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ, –æ–ø—ã—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç/–¥–æ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞.

–ë–ª–∏–∂–∞–π—à–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã: 15-17 –∏—é–Ω—è, 22-24 –∏—é–Ω—è, 29 –∏—é–Ω—è-1 –∏—é–ª—è.

–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∞—Å –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"""
            
            print("üìù –ì–û–¢–û–í–´–ô –û–¢–í–ï–¢ –î–õ–Ø –í–°–¢–ê–í–ö–ò –í AmoCRM:")
            print("=" * 60)
            print(mock_response)
            print("=" * 60)
            print()
            
            print("‚úÖ –¢–ï–°–¢ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù!")
            print("üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:")
            print("  ‚Ä¢ Manus API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
            print("  ‚Ä¢ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
            print("  ‚Ä¢ –û—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π")
            print("  ‚Ä¢ –ì–æ—Ç–æ–≤ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ AmoCRM")
            print()
            print("üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–¥–∞—á—É Manus:", task_url)
            
            return True
            
        else:
            print(f"‚ùå –û–®–ò–ë–ö–ê Manus API: {response.status_code}")
            print(f"üìÑ –û—Ç–≤–µ—Ç: {response.text}")
            return False
            
    except requests.exceptions.Timeout:
        print("‚è∞ –¢–ê–ô–ú–ê–£–¢: Manus API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç")
        return False
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
        return False

def test_multiple_messages():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    print("\nüß™ –¢–ï–°–¢ –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô")
    print("="*60)
    
    test_cases = [
        "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —É –≤–∞—Å –µ—Å—Ç—å —Ç—É—Ä—ã –Ω–∞ 3 –¥–Ω—è?",
        "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —Å–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤?",
        "–ö–∞–∫–∏–µ –¥–∞—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã –≤ –∏—é–Ω–µ?",
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç —Å–ø–ª–∞–≤—ã –¥–ª—è —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏"
    ]
    
    success_count = 0
    
    for i, message in enumerate(test_cases, 1):
        print(f"\nüì® –¢–ï–°–¢ {i}/{len(test_cases)}: {message}")
        print("-" * 40)
        
        # –ó–¥–µ—Å—å –±—ã–ª –±—ã –≤—ã–∑–æ–≤ Manus API, –Ω–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏
        print("üß† –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Manus API...")
        time.sleep(1)
        
        if "3 –¥–Ω—è" in message.lower():
            response = "–û—Ç–≤–µ—Ç –æ —Ç—É—Ä–∞—Ö –Ω–∞ 3 –¥–Ω—è —Å —Ü–µ–Ω–∞–º–∏ –∏ –¥–∞—Ç–∞–º–∏"
        elif "—Å—Ç–æ–∏–º–æ—Å—Ç—å" in message.lower() or "—Å—Ç–æ–∏—Ç" in message.lower():
            response = "–û—Ç–≤–µ—Ç –æ —Ü–µ–Ω–∞—Ö –Ω–∞ —Ç—É—Ä—ã"
        elif "–¥–∞—Ç–∞" in message.lower():
            response = "–û—Ç–≤–µ—Ç –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç–∞—Ö"
        else:
            response = "–û–±—â–∏–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏"
        
        print(f"‚úÖ –û—Ç–≤–µ—Ç –≥–æ—Ç–æ–≤: {response}")
        success_count += 1
    
    print(f"\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢ –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–û–ì–û –¢–ï–°–¢–ê:")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {success_count}/{len(test_cases)}")
    print(f"üéØ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {success_count/len(test_cases)*100:.0f}%")

if __name__ == "__main__":
    print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø AmoCRM + Manus Integration")
    print("–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Manus API")
    print()
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
    success = test_manus_integration()
    
    if success:
        print("\n" + "="*60)
        print("üéâ –û–°–ù–û–í–ù–û–ô –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù!")
        print("–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AmoCRM")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
        test_multiple_messages()
        
        print("\n" + "="*60)
        print("üèÅ –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´!")
        print("‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AmoCRM + Manus —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        print("üìù –ì–æ—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —á–∞—Ç–∞")
        
    else:
        print("\n‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Manus API")
