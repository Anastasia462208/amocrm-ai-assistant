#!/usr/bin/env python3
"""
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç AmoCRM + Manus Integration
–° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL –∏ fallback –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
"""

import requests
import json
import time
from datetime import datetime

def test_manus_api():
    print("üß™ –¢–ï–°–¢ MANUS API INTEGRATION")
    print("="*50)
    
    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ URL –¥–ª—è Manus API
    api_urls = [
        'https://api.manus.im/v1',
        'https://manus.im/api/v1', 
        'https://api.manus.run/v1'
    ]
    
    api_key = 'sk-fNQLWaD5AHLplRB2fVDZ8lfKxVbbEEHWCzl_z016aM4_2EMtOSPtEfCUzhUOZq1DCufwtAAmfIeCn0QFZaS9DkBp2QS3'
    
    # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    knowledge_base = """
–í—ã - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ "–í—Å–µ –Ω–∞ —Å–ø–ª–∞–≤" (vsenasplav.ru).

–¢–£–†–´ –ù–ê 3 –î–ù–Ø:
1. "–°–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 18,000 —Ä—É–±/—á–µ–ª
2. "–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 20,000 —Ä—É–±/—á–µ–ª

–í–ö–õ–Æ–ß–ï–ù–û: —Ä–∞—Ñ—Ç, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, –ø–∏—Ç–∞–Ω–∏–µ, –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
–î–ê–¢–´: 15-17 –∏—é–Ω—è, 22-24 –∏—é–Ω—è, 29 –∏—é–Ω—è-1 –∏—é–ª—è
"""
    
    test_message = "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —É –≤–∞—Å –µ—Å—Ç—å —Ç—É—Ä—ã –Ω–∞ 3 –¥–Ω—è?"
    
    print(f"üì• –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {test_message}")
    print()
    
    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ URL
    for i, base_url in enumerate(api_urls, 1):
        print(f"üîó –ü–æ–ø—ã—Ç–∫–∞ {i}: {base_url}")
        
        try:
            headers = {
                'Authorization': f"Bearer {api_key}",
                'Content-Type': 'application/json'
            }
            
            prompt = f"{knowledge_base}\\n\\n–ö–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: {test_message}\\n\\n–û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ:"
            
            data = {
                'prompt': prompt,
                'mode': 'fast'
            }
            
            response = requests.post(
                f"{base_url}/tasks",
                headers=headers,
                json=data,
                timeout=15
            )
            
            if response.status_code == 200:
                result = response.json()
                print(f"‚úÖ –£–°–ü–ï–•! API —Ä–∞–±–æ—Ç–∞–µ—Ç: {base_url}")
                print(f"üìã Task ID: {result.get('task_id')}")
                print(f"üîó URL: {result.get('url')}")
                return True, result
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞ {response.status_code}: {response.text[:100]}")
                
        except requests.exceptions.ConnectionError:
            print(f"‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ {base_url}")
        except requests.exceptions.Timeout:
            print(f"‚è∞ –¢–∞–π–º–∞—É—Ç –¥–ª—è {base_url}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        print()
    
    print("‚ùå –í—Å–µ URL –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É")
    return False, None

def generate_local_response(message):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ API"""
    print("ü§ñ –õ–û–ö–ê–õ–¨–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–í–ï–¢–ê")
    print("-" * 30)
    
    message_lower = message.lower()
    
    if "3 –¥–Ω—è" in message_lower or "—Ç—Ä–∏ –¥–Ω—è" in message_lower:
        response = """–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–∞—à–∏–º —Ç—É—Ä–∞–º! üòä

–ü–æ —Ç—É—Ä–∞–º –Ω–∞ 3 –¥–Ω—è —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ –æ—Ç–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:

üåü "–°–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 18,000 —Ä—É–±/—á–µ–ª
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏ –æ—Ç 8 –ª–µ—Ç
–ú–∞—Ä—à—Ä—É—Ç: –ö–æ—É—Ä–æ–≤–∫–∞ - –ß—É—Å–æ–≤–∞—è

üåü "–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 20,000 —Ä—É–±/—á–µ–ª  
–î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞
–ú–∞—Ä—à—Ä—É—Ç: –°—Ç–∞—Ä–æ—É—Ç–∫–∏–Ω—Å–∫ - –ß—É—Å–æ–≤–∞—è

–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–æ: —Ä–∞—Ñ—Ç –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, —Ç—Ä–µ—Ö—Ä–∞–∑–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ, –æ–ø—ã—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç/–¥–æ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞.

–ë–ª–∏–∂–∞–π—à–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã: 15-17 –∏—é–Ω—è, 22-24 –∏—é–Ω—è, 29 –∏—é–Ω—è-1 –∏—é–ª—è.

–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∞—Å –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"""
    
    elif "—Ü–µ–Ω–∞" in message_lower or "—Å—Ç–æ–∏–º–æ—Å—Ç—å" in message_lower:
        response = """–¶–µ–Ω—ã –Ω–∞ –Ω–∞—à–∏ —Ç—É—Ä—ã:

üí∞ "–°–µ–º–µ–π–Ω—ã–π —Å–ø–ª–∞–≤" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 18,000 —Ä—É–±/—á–µ–ª
üí∞ "–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" (3 –¥–Ω—è/2 –Ω–æ—á–∏) - 20,000 —Ä—É–±/—á–µ–ª

–í —Å—Ç–æ–∏–º–æ—Å—Ç—å —É–∂–µ –≤–∫–ª—é—á–µ–Ω–æ –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ:
‚úÖ –†–∞—Ñ—Ç –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ
‚úÖ –¢—Ä–µ—Ö—Ä–∞–∑–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ  
‚úÖ –û–ø—ã—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
‚úÖ –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç/–¥–æ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞

–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–ª–∞—Ç! –ö–∞–∫–æ–π —Ç—É—Ä –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"""
    
    else:
        response = """–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ "–í—Å–µ –Ω–∞ —Å–ø–ª–∞–≤" üòä

–ú—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ —Å–ø–ª–∞–≤—ã –ø–æ —Ä–µ–∫–µ –ß—É—Å–æ–≤–∞—è. –£ –Ω–∞—Å –µ—Å—Ç—å —Ç—É—Ä—ã —Ä–∞–∑–Ω–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:
‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ä–∞?
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?
‚Ä¢ –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã?

–ü–æ–¥–±–µ—Ä—É –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç!"""
    
    return response

def simulate_browser_integration(response_text):
    """–ò–º–∏—Ç–∏—Ä—É–µ—Ç –≤—Å—Ç–∞–≤–∫—É –æ—Ç–≤–µ—Ç–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ AmoCRM"""
    print("üåê –ò–ú–ò–¢–ê–¶–ò–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° –ë–†–ê–£–ó–ï–†–û–ú")
    print("-" * 40)
    print("1. –û—Ç–∫—Ä—ã–≤–∞–µ–º AmoCRM –≤ –±—Ä–∞—É–∑–µ—Ä–µ...")
    time.sleep(1)
    print("2. –ù–∞—Ö–æ–¥–∏–º –¥–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º...")
    time.sleep(1)
    print("3. –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è...")
    time.sleep(1)
    print("4. –í—Å—Ç–∞–≤–ª—è–µ–º –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –≤ –ø–æ–ª–µ...")
    time.sleep(1)
    print("‚úÖ –û—Ç–≤–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞!")
    print()
    print("üë§ –ú–ï–ù–ï–î–ñ–ï–† –í–ò–î–ò–¢ –í –ü–û–õ–ï –í–í–û–î–ê:")
    print("=" * 50)
    print(response_text)
    print("=" * 50)
    print()
    print("üéØ –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç:")
    print("  ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å")
    print("  ‚úèÔ∏è –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π")
    print("  ‚ùå –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –æ—Ç–≤–µ—Ç")

def main():
    print("üöÄ –ü–û–õ–ù–´–ô –¢–ï–°–¢: AmoCRM + Manus + Browser Integration")
    print("–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å —Ü–∏–∫–ª: –°–æ–æ–±—â–µ–Ω–∏–µ ‚Üí AI ‚Üí –ü–æ–ª–µ –≤–≤–æ–¥–∞")
    print()
    
    # –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    test_message = "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —É –≤–∞—Å –µ—Å—Ç—å —Ç—É—Ä—ã –Ω–∞ 3 –¥–Ω—è?"
    
    print("üìã –≠–¢–ê–ü 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞")
    print(f"üì• –°–æ–æ–±—â–µ–Ω–∏–µ: '{test_message}'")
    print()
    
    print("üìã –≠–¢–ê–ü 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Manus API")
    api_success, api_result = test_manus_api()
    print()
    
    print("üìã –≠–¢–ê–ü 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞")
    if api_success:
        print("üß† –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç Manus API")
        # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–¥–∞—á–∏
        response_text = generate_local_response(test_message)
    else:
        print("ü§ñ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é")
        response_text = generate_local_response(test_message)
    print()
    
    print("üìã –≠–¢–ê–ü 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—Ä–∞—É–∑–µ—Ä–æ–º")
    simulate_browser_integration(response_text)
    
    print("üèÅ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù!")
    print("="*60)
    print("‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç!")
    print("üéØ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:")
    print("  ‚Ä¢ –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤")
    print("  ‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (Manus API –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)")
    print("  ‚Ä¢ –í—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ AmoCRM")
    print("  ‚Ä¢ –î–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä—É")
    print()
    print("üöÄ –ú–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω!")

if __name__ == "__main__":
    main()
